<?xml version="1.0" encoding="UTF-8"?>
<MetricDescriptor>
  <metricName > IQSysmon </metricName>
  <metricType > BUILTIN </metricType>
  <delay> 0 </delay>
  <SQL >
      sp_iqsysmon "00:01:00"
  </SQL>
  <colsCalcDiff >
  </colsCalcDiff>
  <mandatoryConfigs>
  </mandatoryConfigs>
  <createTables>
     <T>
create table ?SERVERNAME?_IQSysmon (
Timestamp datetime not null,
Interval int not null,

prefetch_main_PFMgrNThreads             int null,
prefetch_main_PFMgrNSubmitted           int null,
prefetch_main_PFMgrNDropped             int null,
prefetch_main_PFMgrNValid               int null,
prefetch_main_PFMgrNRead                int null,
prefetch_main_PFMgrNReading             int null,
prefetch_main_PFMgrCondVar_Locks        int null,

prefetch_temp_PFMgrNThreads             int null,
prefetch_temp_PFMgrNSubmitted           int null,
prefetch_temp_PFMgrNDropped             int null,
prefetch_temp_PFMgrNValid               int null,
prefetch_temp_PFMgrNRead                int null,
prefetch_temp_PFMgrNReading             int null,
prefetch_temp_PFMgrCondVar_Locks        int null,

freelist_main_FLBitCount                int null,
freelist_main_FLMutexLocks              int null,
freelist_main_FLMutexWaits              int null,

freelist_temp_FLBitCount                int null,
freelist_temp_FLMutexLocks              int null,
freelist_temp_FLMutexWaits              int null,

memory_MemAllocated              bigint null,
memory_MemAllocatedMax           bigint null,
memory_MemAllocatedEver          bigint null,
memory_MemNAllocated             int null,
memory_MemNAllocatedEver         int null,
memory_MemNTimesLocked           int null,
memory_MemNTimesWaited           int null,

threads_ThrNumOfCpus             int null,
threads_ThreadLimit              int null,
threads_ThrNumThreads            int null,
threads_ThrReserved              int null,
threads_ThrNumFree               int null,
threads_NumThrUsed               int null,
threads_UsedPerActiveCmd         int null,
threads_ThrNTeamsInUse           int null,
threads_ThrMaxTeams              int null,
threads_NumTeamsAlloc            int null,
threads_TeamThrAlloc             int null,
threads_SingleThrAlloc           int null,
threads_ThrMutexLocks            int null,
threads_ThrMutexWaits            int null,

cpu_ElapsedSec                   float null,
cpu_CPUUserSec                   float null,
cpu_CPUSysSec                    float null,
cpu_CPUTotalSec                  float null,

catalog_CatalogLock_RdLocks          int null,
catalog_CatalogLock_RdWaits          int null,
catalog_CatalogLock_RdTryFails       int null,
catalog_CatalogLock_WrLocks          int null,
catalog_CatalogLock_WrWaits          int null,
catalog_CatalogLock_WrTryFails       int null,
catalog_DbLogMLock_Locks             int null,
catalog_DbLogMLock_LockWaits         int null,
catalog_DbLogSLock_Locks             int null,
catalog_DbLogSLock_LockWaits         int null,
catalog_RepositoryNList              int null,
catalog_RepositoryLock_Locks         int null,
catalog_RepositoryLock_SpinsWoTO     int null,
catalog_RepositoryLock_Spins         int null,
catalog_RepositoryLock_TimeOuts      int null,

txn_TxnMgrNPending                 int null,
txn_TxnMgrNBlocked                 int null,
txn_TxnMgrNWaiting                 int null,
txn_TxnMgrPCcondvar_Locks          int null,
txn_TxnMgrPCcondvar_LockWaits      int null,
txn_TxnMgrPCcondvar_Signals        int null,
txn_TxnMgrPCcondvar_Broadcasts     int null,
txn_TxnMgrPCcondvar_Waits          int null,
txn_TxnMgrTxnIDseq                 int null,
txn_TxnMgrtxncblock_Locks          int null,
txn_TxnMgrtxncblock_LockWaits      int null,
txn_TxnMgrVersionID                int null,
txn_TxnMgrOAVI                     int null,
txn_TxnMgrVersionLock_Locks        int null,
txn_TxnMgrVersionLock_LockWaits    int null,
txn_TxnMgrVersionLock_Signals      int null,
txn_TxnMgrVersionLock_Broadcasts   int null,
txn_TxnMgrVersionLock_Waits        int null,

server_StCntxNumConns            int null,
server_StCntxNResource           int null,
server_StCntxNOrigResource       int null,
server_StCntxNWaiting            int null,
server_StCntxNWaited             int null,
server_StCntxNAdmitted           int null,
server_StCntxLock_Locks          int null,
server_StCntxLock_LockWaits      int null,
server_StCntxCondVar_Locks       int null,
server_StCntxCondVar_LockWaits   int null

) lock datapages
</T>
<T>
create table ?SERVERNAME?_IQSysmon_buf (
Timestamp datetime not null,
Interval int not null,

bufman_main_Finds                int null,
bufman_main_Hits                 int null,
bufman_main_HitPercent           float null,
bufman_main_FalseMiss            int null,
bufman_main_UnOwnRR              int null,
bufman_main_Cloned               int null,
bufman_main_Creates              int null,
bufman_main_Destroys             int null,
bufman_main_Dirties              int null,
bufman_main_RealDirties          int null,
bufman_main_PrefetchReqs         int null,
bufman_main_PrefetchNotInMem     int null,
bufman_main_PrefetchInMem        int null,
bufman_main_Reads                int null,
bufman_main_PReadBlks            int null,
bufman_main_PReadKB              int null,
bufman_main_ReReads              int null,
bufman_main_Writes               int null,
bufman_main_PWriteBlks           int null,
bufman_main_PWriteKB             int null,
bufman_main_GrabbedDirty         int null,
bufman_main_BusyWaits                 int null,
bufman_main_LRUNumLocks               int null,
bufman_main_LRUNumSpinsWoTO           int null,
bufman_main_LRUNumSpinLoops           int null,
bufman_main_LRUNumTimeOuts            int null,
bufman_main_BmapHTNumLocks            int null,
bufman_main_BmapHTNumWaits            int null,
bufman_main_CacheTeamTimesWoken       int null,
bufman_main_CacheTeamNumAsleep        int null,
bufman_main_BmapHTMaxEntries          int null,
bufman_main_BmapHTNEntries            int null,
bufman_main_BmapHTNInserts            int null,
bufman_main_BmapHTNCollisn            int null,
bufman_main_BmapHTNFinds              int null,
bufman_main_BmapHTNHits               int null,
bufman_main_BmapHTNHits1              int null,
bufman_main_BmapHTNHits2              int null,
bufman_main_BmapHTNClears             int null,
bufman_main_BmapHTNLChain             int null,
bufman_main_BmapHTNRehash             int null,
bufman_main_BlockmapMutexsNLocks      int null,
bufman_main_BlockmapMutexsNWaits      int null,
bufman_main_BlockmapUID               int null,
bufman_main_BlockmapUIDnallocs        int null,
bufman_main_BlockmapRegEver           int null,
bufman_main_BlockmapRegisters         int null,
bufman_main_BufHTNBuckets             int null,
bufman_main_BufHTNEntries             int null,
bufman_main_BufHTNw2orMore            int null,
bufman_main_BufHTMaxBucketSize        int null,
bufman_main_BufHTNFoiledOps           int null,
bufman_main_IONumLocks                int null,
bufman_main_IONumWaits                int null,

bufman_temp_Finds                int null,
bufman_temp_Hits                 int null,
bufman_temp_HitPercent           float null,
bufman_temp_FalseMiss            int null,
bufman_temp_UnOwnRR              int null,
bufman_temp_Cloned               int null,
bufman_temp_Creates              int null,
bufman_temp_Destroys             int null,
bufman_temp_Dirties              int null,
bufman_temp_RealDirties          int null,
bufman_temp_PrefetchReqs         int null,
bufman_temp_PrefetchNotInMem     int null,
bufman_temp_PrefetchInMem        int null,
bufman_temp_Reads                int null,
bufman_temp_PReadBlks            int null,
bufman_temp_PReadKB              int null,
bufman_temp_ReReads              int null,
bufman_temp_Writes               int null,
bufman_temp_PWriteBlks           int null,
bufman_temp_PWriteKB             int null,
bufman_temp_GrabbedDirty         int null,
bufman_temp_BusyWaits                 int null,
bufman_temp_LRUNumLocks               int null,
bufman_temp_LRUNumSpinsWoTO           int null,
bufman_temp_LRUNumSpinLoops           int null,
bufman_temp_LRUNumTimeOuts            int null,
bufman_temp_BmapHTNumLocks            int null,
bufman_temp_BmapHTNumWaits            int null,
bufman_temp_CacheTeamTimesWoken       int null,
bufman_temp_CacheTeamNumAsleep        int null,
bufman_temp_BmapHTMaxEntries          int null,
bufman_temp_BmapHTNEntries            int null,
bufman_temp_BmapHTNInserts            int null,
bufman_temp_BmapHTNCollisn            int null,
bufman_temp_BmapHTNFinds              int null,
bufman_temp_BmapHTNHits               int null,
bufman_temp_BmapHTNHits1              int null,
bufman_temp_BmapHTNHits2              int null,
bufman_temp_BmapHTNClears             int null,
bufman_temp_BmapHTNLChain             int null,
bufman_temp_BmapHTNRehash             int null,
bufman_temp_BlockmapMutexsNLocks      int null,
bufman_temp_BlockmapMutexsNWaits      int null,
bufman_temp_BlockmapUID               int null,
bufman_temp_BlockmapUIDnallocs        int null,
bufman_temp_BlockmapRegEver           int null,
bufman_temp_BlockmapRegisters         int null,
bufman_temp_BufHTNBuckets             int null,
bufman_temp_BufHTNEntries             int null,
bufman_temp_BufHTNw2orMore            int null,
bufman_temp_BufHTMaxBucketSize        int null,
bufman_temp_BufHTNFoiledOps           int null,
bufman_temp_IONumLocks                int null,
bufman_temp_IONumWaits                int null,

bufpool_main_MovedToMRU                 int null,
bufpool_main_MovedToWash                int null,
bufpool_main_RemovedFromLRU             int null,
bufpool_main_RemovedFromWash            int null,
bufpool_main_RemovedInScanMode          int null,
bufpool_main_MovedToPSList              int null,
bufpool_main_RemovedFromPSList          int null,
bufpool_main_Pages                      int null,
bufpool_main_InUse                      int null,
bufpool_main_Dirty                      int null,
bufpool_main_Pinned                     int null,
bufpool_main_Flushes                    int null,
bufpool_main_FlushedBufferCount         int null,
bufpool_main_GetPageFrame               int null,
bufpool_main_GetPageFrameFailure        int null,
bufpool_main_GotEmptyFrame              int null,
bufpool_main_Washed                     int null,
bufpool_main_TimesSweepersWoken         int null,
bufpool_main_PriorityWashed             int null,
bufpool_main_NPrioritySweepersWoken     int null,
bufpool_main_washTeamSize               int null,
bufpool_main_WashMaxSize                int null,
bufpool_main_washNBuffers               int null,
bufpool_main_washNDirtyBuffers          int null,
bufpool_main_washSignalThreshold        int null,
bufpool_main_washNActiveSweepers        int null,
bufpool_main_NPriorityWashBuffers       int null,
bufpool_main_NActivePrioritySweepers    int null,
bufpool_main_washIntensity              int null,
bufpool_main_FlushAndEmpties            int null,
bufpool_main_EmptiedBufferCount         int null,
bufpool_main_EmptiedSkippedCount        int null,
bufpool_main_EmptiedWriteCount          int null,
bufpool_main_EmptiedErrorCount          int null,

bufpool_temp_MovedToMRU                 int null,
bufpool_temp_MovedToWash                int null,
bufpool_temp_RemovedFromLRU             int null,
bufpool_temp_RemovedFromWash            int null,
bufpool_temp_RemovedInScanMode          int null,
bufpool_temp_MovedToPSList              int null,
bufpool_temp_RemovedFromPSList          int null,
bufpool_temp_Pages                      int null,
bufpool_temp_InUse                      int null,
bufpool_temp_Dirty                      int null,
bufpool_temp_Pinned                     int null,
bufpool_temp_Flushes                    int null,
bufpool_temp_FlushedBufferCount         int null,
bufpool_temp_GetPageFrame               int null,
bufpool_temp_GetPageFrameFailure        int null,
bufpool_temp_GotEmptyFrame              int null,
bufpool_temp_Washed                     int null,
bufpool_temp_TimesSweepersWoken         int null,
bufpool_temp_PriorityWashed             int null,
bufpool_temp_NPrioritySweepersWoken     int null,
bufpool_temp_washTeamSize               int null,
bufpool_temp_WashMaxSize                int null,
bufpool_temp_washNBuffers               int null,
bufpool_temp_washNDirtyBuffers          int null,
bufpool_temp_washSignalThreshold        int null,
bufpool_temp_washNActiveSweepers        int null,
bufpool_temp_NPriorityWashBuffers       int null,
bufpool_temp_NActivePrioritySweepers    int null,
bufpool_temp_washIntensity              int null,
bufpool_temp_FlushAndEmpties            int null,
bufpool_temp_EmptiedBufferCount         int null,
bufpool_temp_EmptiedSkippedCount        int null,
bufpool_temp_EmptiedWriteCount          int null,
bufpool_temp_EmptiedErrorCount          int null,

bufalloc_main_NActiveCommands           int null,
bufalloc_main_BufAllocMaxBufs           int null,
bufalloc_main_BufAllocAvailBufs         int null,
bufalloc_main_BufAllocReserved          int null,
bufalloc_main_BufAllocAvailPF           int null,
bufalloc_main_BufAllocSlots             int null,
bufalloc_main_BufAllocNPinUsers         int null,
bufalloc_main_BufAllocNPFUsers          int null,
bufalloc_main_BufAllocNPostedUsrs       int null,
bufalloc_main_BufAllocNUnpostUsrs       int null,
bufalloc_main_BufAllocPinQuota          int null,
bufalloc_main_BufAllocNPostEst          int null,
bufalloc_main_BufAllocNUnPostEst        int null,
bufalloc_main_BufAllocMutexLocks        int null,
bufalloc_main_BufAllocMutexWaits        int null,
bufalloc_main_NumClients                int null,
bufalloc_main_PinUserQuota              int null,
bufalloc_main_PrefetchUserQuota         int null,
bufalloc_main_PinUserRegisters          int null,
bufalloc_main_PfUserRegisters           int null,
bufalloc_main_ClientCountOfPinners      int null,
bufalloc_main_Hash                      int null,
bufalloc_main_Sort                      int null,
bufalloc_main_Row                       int null,
bufalloc_main_RowColumn                 int null,
bufalloc_main_FP                        int null,
bufalloc_main_Garray                    int null,
bufalloc_main_LOB                       int null,
bufalloc_main_BTree                     int null,
bufalloc_main_BM                        int null,
bufalloc_main_BV                        int null,
bufalloc_main_Store                     int null,
bufalloc_main_Test                      int null,
bufalloc_main_DBCC                      int null,
bufalloc_main_Run                       int null,
bufalloc_main_QCPRun                    int null,
bufalloc_main_TextDoc                   int null,

bufalloc_temp_NActiveCommands           int null,
bufalloc_temp_BufAllocMaxBufs           int null,
bufalloc_temp_BufAllocAvailBufs         int null,
bufalloc_temp_BufAllocReserved          int null,
bufalloc_temp_BufAllocAvailPF           int null,
bufalloc_temp_BufAllocSlots             int null,
bufalloc_temp_BufAllocNPinUsers         int null,
bufalloc_temp_BufAllocNPFUsers          int null,
bufalloc_temp_BufAllocNPostedUsrs       int null,
bufalloc_temp_BufAllocNUnpostUsrs       int null,
bufalloc_temp_BufAllocPinQuota          int null,
bufalloc_temp_BufAllocNPostEst          int null,
bufalloc_temp_BufAllocNUnPostEst        int null,
bufalloc_temp_BufAllocMutexLocks        int null,
bufalloc_temp_BufAllocMutexWaits        int null,
bufalloc_temp_NumClients                int null,
bufalloc_temp_PinUserQuota              int null,
bufalloc_temp_PrefetchUserQuota         int null,
bufalloc_temp_PinUserRegisters          int null,
bufalloc_temp_PfUserRegisters           int null,
bufalloc_temp_ClientCountOfPinners      int null,
bufalloc_temp_Hash                      int null,
bufalloc_temp_Sort                      int null,
bufalloc_temp_Row                       int null,
bufalloc_temp_RowColumn                 int null,
bufalloc_temp_FP                        int null,
bufalloc_temp_Garray                    int null,
bufalloc_temp_LOB                       int null,
bufalloc_temp_BTree                     int null,
bufalloc_temp_BM                        int null,
bufalloc_temp_BV                        int null,
bufalloc_temp_Store                     int null,
bufalloc_temp_Test                      int null,
bufalloc_temp_DBCC                      int null,
bufalloc_temp_Run                       int null,
bufalloc_temp_QCPRun                    int null,
bufalloc_temp_TextDoc                   int null

) lock datapages
     </T>
  </createTables>

  <createIndexes>
     <I>
  create index idx on ?SERVERNAME?_IQSysmon (Timestamp, Interval )
     </I>
     <I>
  create index idx on ?SERVERNAME?_IQSysmon_buf (Timestamp, Interval )
     </I>
  </createIndexes>

  <purge>
    <P table="?SERVERNAME?_IQSysmon" >
  delete ?SERVERNAME?_IQSysmon where Timestamp &lt; ?DATE?
    </P>
    <P table="?SERVERNAME?_IQSysmon_buf" >
  delete ?SERVERNAME?_IQSysmon_buf where Timestamp &lt; ?DATE?
    </P>
  </purge>

</MetricDescriptor>
